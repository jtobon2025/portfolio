<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Projected Cash Flow Chart</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Incluye html2canvas desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<!-- Barra de herramientas de compartir -->
<div class="share-toolbar">
    <div class="toolbar-item">
        <button class="share-btn" onclick="toggleShareMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 16C16.7 16 15.5 16.5 14.6 17.4L8.9 14.5C9 14.3 9 14.2 9 14C9 13.8 9 13.7 8.9 13.5L14.5 10.6C15.4 11.5 16.7 12 18 12C19.7 12 21 10.7 21 9C21 7.3 19.7 6 18 6C16.3 6 15 7.3 15 9C15 9.2 15 9.4 15.1 9.6L9.5 12.5C8.6 11.6 7.3 11 6 11C4.3 11 3 12.3 3 14C3 15.7 4.3 17 6 17C7.3 17 8.6 16.4 9.5 15.5L15.1 18.4C15 18.6 15 18.8 15 19C15 20.7 16.3 22 18 22C19.7 22 21 20.7 21 19C21 17.3 19.7 16 18 16Z" fill="#333"/>
            </svg>
            Share
        </button>
        <div class="share-menu">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.linkedin.com/in/jorge-tobon-forum-financiero/" class="share-option">
                <img src="linkedin-icon.png" alt="LinkedIn"> LinkedIn
            </a>
            <a href="https://x.com/share?url=https://jtobon2025.github.io/portfolio/" class="share-option">
                <img src="x-icon.png" alt="X"> X
            </a>
            <a href="mailto:?subject=Check%20this%20out&body=Here%20is%20something%20interesting:%20https://jtobon2025.github.io/portfolio/" class="share-option">
                <img src="email-icon.png" alt="Email"> Email
            </a>
        </div>
    </div>

    <!-- Botones adicionales -->
    <button class="share-btn" onclick="window.print()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 19V15H18V19H6ZM8 17H16V19H8V17ZM19 8H5V11H19V8ZM18 4H6V8H18V4Z" fill="#333"/>
        </svg>
        Print
    </button>

    <!-- Botón de descargar con SVG de icono y funcionalidad de captura de pantalla -->
    <button class="share-btn" onclick="downloadScreenshot()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C11.4477 2 11 2.44772 11 3V13.5858L8.70711 11.2929C8.31658 10.9024 7.68342 10.9024 7.29289 11.2929C6.90237 11.6834 6.90237 12.3166 7.29289 12.7071L11.2929 16.7071C11.6834 17.0976 12.3166 17.0976 12.7071 16.7071L16.7071 12.7071C17.0976 12.3166 17.0976 11.6834 16.7071 11.2929C16.3166 10.9024 15.6834 10.9024 15.2929 11.2929L13 13.5858V3C13 2.44772 12.5523 2 12 2Z" fill="#333"/>
            <path d="M4 18C4 17.4477 4.44772 17 5 17H19C19.5523 17 20 17.4477 20 18C20 18.5523 19.5523 19 19 19H5C4.44772 19 4 18.5523 4 18Z" fill="#333"/>
        </svg>
        Download
    </button>

    <button class="share-btn">
        <svg> <!-- SVG del icono de guardar --> </svg>
        Save
    </button>
</div>

<!-- Resto del contenido de la página -->
<header>
    <nav>
        <h1>My project</h1>
        <ul>
            <li><a href="index.html">Home</a></li>
        </ul>
    </nav>
</header>

<main class="project-content">
    <h2>Dynamic Projected Cash Flow Chart</h2>
    <section class="project-description">
        <h3>Project Overview</h3>
        <p>This project implements a complex class to analyze and project cash flow using historical data stored in a SQLite database, integrating advanced data processing, visualization with Plotly, and financial calculations. The user interface is developed in HTML5 and JavaScript, while the business logic is managed in Python using a Flask server.</p>
        <p>The class also allows comparing two cash flow projections to observe variations in estimates of cash inflows and outflows, facilitating strategic decision-making based on different financial scenarios.</p>
        <p>Additionally, the class features an advanced method that calculates the additional cash needed to reach a target balance. This method evaluates projected inflows and outflows, adjusting cash entries as needed to maintain the balance at the desired level, providing a useful tool for treasury planning and strategic decision-making.</p>
        <hr>
        <h4>Code Strengths</h4>
        <ol class="strengths-list">
            <!-- Lista de fortalezas del código -->
            <!-- Se mantiene el contenido original -->
        </ol>
    </section>

    <!-- Sección para gráficos con Plotly -->
    <div id="graph-container">
        <iframe id="plotly-graph-1" src="saldo_proyectado.html" width="100%" height="500px" style="border:none;"></iframe>
        <iframe id="plotly-graph-2" src="saldo_proyectado_combinado.html" width="100%" height="500px" style="border:none;"></iframe>
        <iframe id="plotly-graph-3" src="saldo_proyectado2.html" width="100%" height="500px" style="border:none;"></iframe>
    </div>

    <p><a href="code_3.html">View Code</a></p>
    <a href="index.html" class="back-button">Return to Home</a>
</main>

<footer>
    <p>© 2024 Jorge Tobón. All rights reserved.</p>
</footer>

<script>
    // Función para mostrar/ocultar el menú de compartir
    function toggleShareMenu() {
        const menu = document.querySelector('.share-menu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // Función para capturar gráficos de Plotly
    async function capturePlotlyGraph(iframeId) {
        const iframe = document.getElementById(iframeId);
        const graphWindow = iframe.contentWindow;
        const graphDocument = graphWindow.document;
        const plotlyCanvas = graphDocument.querySelector('canvas');

        // Captura el gráfico como imagen
        return html2canvas(plotlyCanvas).then(canvas => canvas.toDataURL('image/png'));
    }

    // Función para capturar el contenido del cuerpo de la página
    function captureBodyContent() {
        return html2canvas(document.body).then(canvas => canvas.toDataURL('image/png'));
    }

    // Función principal para capturar y combinar las imágenes
    async function downloadScreenshot() {
        try {
            // Captura los gráficos individualmente
            const graph1 = await capturePlotlyGraph('plotly-graph-1');
            const graph2 = await capturePlotlyGraph('plotly-graph-2');
            const graph3 = await capturePlotlyGraph('plotly-graph-3');

            // Captura el contenido restante de la página
            const bodyContent = await captureBodyContent();

            // Aquí podrías combinar las imágenes en un solo canvas o manipularlas según sea necesario.

            // Ejemplo: Creando un enlace de descarga para la primera imagen capturada (bodyContent)
            const link = document.createElement('a');
            link.href = bodyContent;  // Podrías cambiar esto para combinar imágenes
            link.download = 'captura_pagina.png';
            link.click();
        } catch (error) {
            console.error('Error al capturar la página:', error);
            alert('Ocurrió un error al capturar la página.');
        }
    }
</script>

</body>
</html>
